# 任务计划：对齐 antd 6.0.0 并重构 Dioxus 组件

## 目标与范围
- 基于 `tmp/antd-6.0.0` 源码，对齐现有组件（Button/FloatButton/Icon/Typography/Divider/Flex/Grid/Layout/Masonry/Space/Splitter）。
- 扩展主题令牌与样式体系，使之更贴近 Ant Design 6.0.0，并符合 Dioxus/Rust 约定。
- 更新 demo 与文档，补充测试与缺陷修复，确保交互与 ARIA 语义无回归。

## 调研与差异梳理
- 现状：主题 tokens 精简，样式集中于 `THEME_BASE_STYLE`；组件覆盖基础属性，缺少 Group/BackTop/Tooltip/Badge 等子特性；示例仅五个，缺少 docs 目录与系统性测试。
- 目标对齐点（来自 `tmp/antd-6.0.0/lib`）：
  - Button：color/variant 拆分、ghost 变体、loading delay 与自定义 icon、iconPlacement/start|end、autoInsertSpace、Button.Group、禁用 href 阻断、classNames/styles 透传、波纹/active 态。
  - FloatButton：Group/BackTop/PurePanel、Tooltip/Badge 支持、shape=square 文本、z-index 管理、上下文继承、默认 icon/description。
  - Flex：orientation 支持、gap 预设映射、wrap/justify/align 类名策略、自定义标签、CSS 变量。
  - Grid：row/col 双向 gutter、响应式断点（xs-sm-md-lg-xl-xxl）、flex/offset/push/pull/order、RTL/容器行内 spacing。
  - Space：size 预设与 split、wrap、对齐、Compact 场景兼容。
  - Typography：type/disabled/danger/secondary、ellipsis 展开、copyable、editable、Title/Paragraph/Text 共享样式。
  - Layout：Sider 可折叠/触发器、theme 继承、content/header/footer 前缀 class 与背景。
  - Divider/Masonry/Splitter：水平/垂直/带文字/虚线、Masonry 列数与 gap 支持、Splitter 拖拽/受控尺寸/纵横向光标。
  - Icon：需允许外部 SVG/ReactNode 传入或扩展内置集合，支持 spin/rotate/size。

## 里程碑与任务拆解
1) **基线与对齐策略（优先级 P0）**
   - 通读 `tmp/antd-6.0.0` 中对应组件实现，整理 API 与行为差异清单。
   - 确定命名与前缀策略：保留 `adui-` 还是与 antd 一致前缀；确定 CSS 变量命名映射。
   - 设计向后兼容策略（旧属性映射到新 API，必要时标注 deprecated）。

2) **主题与样式体系升级（P0）**
   - 扩展 `ThemeTokens`：补齐常用色板（text/secondary/disabled/link/bg/container/split/colorFill/colorBorder)、尺寸（line-height、font-size-sm/lg、padding-sm/lg、control-line-width/outline等）、阴影、radius、motion duration。
   - 抽离样式为分模块 CSS（按钮/排版/布局），避免单一字符串臃肿；保留 `ThemeProvider` 导出 CSS 变量。
   - 校准暗色/自定义模式与 token 默认值，验证 css vars 输出。

3) **组件重构（P0/P1，按优先级执行）**
   - Button：引入 color+variant API（primary/default/dashed/link/text/solid/outlined）、ghost 行为、iconPlacement、loading delay、自定义 loading icon、href 禁用态阻止点击、ButtonGroup 支持、类名/样式透传、ARIA（aria-busy/aria-disabled/role）。
   - FloatButton：支持 Group/BackTop/PurePanel，tooltip/badge/content 属性，shape= square 文本展示，z-index 处理，危险/主色取 token，受控位置 props。
   - Flex/Space：加入 size 预设、orientation/wrap/gap 处理、子元素间 split/compact 兼容；补充 align/justify 映射与样式。
   - Grid：实现 responsive span/offset/order/push/pull；gutter 支持数组/对象（水平+垂直）；row/col 断点媒体样式生成；保持 24 栅格默认。
   - Typography：支持 copyable/ellipsis 可展开、省略行数、editable 回调，type 映射，标题等级样式；ARIA 与 keyboard 交互。
   - Layout：Sider 折叠/触发器/宽度受控，layout/theme 属性，RTL 支持；content/header/footer padding/背景与 token 对齐。
   - Divider/Masonry/Splitter：Divider 位置/类型/虚线；Masonry 列数/间距 props；Splitter 可拖拽/受控比例/回调（on_move/on_release），光标样式及触控优化。
   - Icon：允许传入 SVG 节点或扩展内置表，支持自定义 viewBox/aria；保持 spin/rotate 封装。

4) **Demo 与文档更新（P1）**
   - 扩充 `examples/`：新增或更新 button/flex/grid/typography/float_button/space/splitter demo 覆盖新 API 与边界场景（loading delay、responsive gutter、copyable 等）。
   - 新建 `docs/`：每个组件写概览、API 表、差异说明、示例片段；在 README 链接并更新组件进度。
   - 提供迁移指引（旧 props 映射、新增破坏性变更列表）。

5) **测试与缺陷修复（P1/P2）**
   - 单元测试：主题 tokens 导出、辅助函数（如 gutter 计算、loading delay）、ARIA 属性与受控逻辑。
   - 集成/快照：关键渲染（Button variant/iconPlacement、Grid 响应式、Typography ellipsis/copyable）；必要时添加 wasm-less 渲染测试。
   - 手动验证：示例运行、键盘可达性、禁用态点击、RTL/暗色模式。

6) **收尾与交付（P2）**
   - 运行 `cargo fmt`, `cargo clippy --all-targets --all-features`, `cargo test`，记录结果。
   - 整理变更摘要、已知限制与后续待办。

## 关键风险与对策
- tokens 体积膨胀：按照 antd 6 常用集筛选核心子集，避免一次性全量复制；未覆盖部分在文档列出。
- Dioxus 事件差异：href 禁用、拖拽、复制等需验证浏览器与 desktop 兼容，必要时加防御代码。
- 样式冲突：分组件注入样式并使用唯一前缀/作用域，避免示例样式干扰。
- 响应式/媒体查询生成：注意重复注入导致的性能问题，可考虑生成静态 `<style>` 片段带唯一类名。

## 命名与兼容策略（已定）
- 类名前缀：继续使用 `adui-`，保持现有使用方不破坏，同时在文档中标明与 antd 语义映射（如 `adui-btn` 对应 antd `ant-btn`）。
- CSS 变量：沿用 `--adui-*` 命名，新增 tokens 按照 antd 含义映射命名（如 `--adui-color-text-secondary`），避免与用户全局变量冲突。
- Props 兼容：保留现有 `r#type/size/shape/danger/ghost/block` 等属性，新增 color/variant/icon_placement/loading_delay 等属性。旧属性将映射到新语义（例如 `type=Primary` -> `color=primary, variant=solid`），并在文档标注弃用路径，必要时打印编译期 deprecation note。

## TODO 列表（可执行）
- [x] 基线梳理
  - [x] 针对 Button/FloatButton/Flex/Grid/Space/Typography/Layout/Divider/Masonry/Splitter/Icon 分别阅读 `tmp/antd-6.0.0/lib` 源码，列出 API/行为/样式差异清单（落地为 `docs/diff/<component>.md` 草稿）。
  - [x] 决定类名前缀与 CSS 变量命名策略（保留 `adui-` 前缀 + 兼容 antd 语义映射），形成兼容性说明。
  - [x] 定义向后兼容方案（旧 props 到新 props 的映射、弃用提示策略）。
- [x] 主题与样式体系升级
  - [x] 整理 antd 6 常用 tokens（颜色、尺寸、边框、阴影、动画时长）并扩展 `ThemeTokens` 与默认 Light/Dark 值。
  - [x] 更新 CSS 变量导出与 `ThemeProvider`，覆盖新增 tokens；保留 Custom 模式可覆盖。
  - [x] 拆分 `THEME_BASE_STYLE` 为按组件注入的样式片段（按钮/排版/布局/栅格/浮动按钮/分割线等）。
  - [x] 校验 CSS 变量命名与使用位置（按钮/排版/布局）一致性，补充暗色/高对比检查（已将分割线、按钮边框线宽、排版行高等使用新变量）。
- [x] 组件重构：Button（新增 ButtonGroup 上下文继承，视觉/ARIA 对齐，键盘行为待测试阶段复核）
  - [x] 设计 Rust Props：color + variant 组合、ghost、danger、shape、size、block、href/disabled/loading(delay/icon)、iconPlacement、classNames/styles 透传、ButtonGroup。
  - [x] 实现 loading delay 与自定义 loading icon，href 禁用态阻止点击与聚焦。
  - [x] 实现 auto-insert-space（单个双字节字符的空格插入）与 icon-only 判断。
  - [x] 增加 Button.Group 组件（size/shape/variant 继承，紧凑边框调整）。
  - [x] 样式对齐：variant(solid/outlined/text/link/dashed)、ghost 背景、active/focus 阴影、block/RTL（已重写视觉算法、Focus ring、RTL group 边界）。
  - [x] ARIA：`aria-busy`、`aria-disabled`、role/button，键盘可达性校验（基础属性已加，键盘交互待验证）。
- [ ] 组件重构：FloatButton（PurePanel 暂未实现，其他能力已完成）
  - [x] Props：type(default/primary)、shape(circle/square)、badge/tooltip/content/description、icon、href/on_click、z_index/placement（top/bottom/left/right）、danger，BackTop 继承 FloatButtonProps（shape/type/badge/位置）。
  - [x] 支持 Group/PurePanel/BackTop（已提供 Group/BackTop 组件，PurePanel 待定）。
  - [x] 样式：补齐独立/分组布局、square 文案纵向排布、badge dot/位置、focus ring、icon-only 尺寸、CSS 变量（已引入上下文感知 group、.adui-float-btn-individual、badge dot、square 内容间距）。
  - [x] ARIA：`aria-label`，禁用/加载态阻断（基础 aria 已覆盖，需手动校验）。
- [x] 组件重构：Flex 与 Space
  - [x] Flex：
    - [x] orientation/vertical 语义、gap 预设（small/middle/large）、wrap/justify/align 类名策略与样式落地。
    - [x] 自定义 component/tag 选择（div/section/article/nav/span）与 `FlexConfigProvider` 上下文继承。
  - [x] Space：size 预设（small/middle/large）+ 自定义 gap/gap_cross、split 插入、wrap、align、Compact 模式类名。
  - [x] 提炼公共 gap 计算与 class 生成工具函数（`layout_utils` 复用 gap preset + style 拼接）。
- [x] 组件重构：Grid
  - [x] Row：支持 gutter 单值/数组（水平+垂直）与响应式对象（各断点），justify/align 语义映射（`RowGutter` + CSS 变量/响应式样式；文档与 demo 已覆盖）。
  - [x] Col：支持 span/offset/push/pull/order 以及 xs-sm-md-lg-xl-xxl 响应式配置；flex 属性兼容（`ColResponsive` + `ColSize`，配套示例/文档已提供）。
  - [x] 生成媒体查询样式片段，确保唯一类名（Row/Col 皆使用唯一 class + 内联 `<style>`）；RTL 另行规划。
  - [x] 修复 `gutter_spec` 解构遗漏，保障 Row props 编译通过并与 demo 一体验证。
- [x] 组件重构：Typography
  - [x] Props：扩展 `TextType`（default/secondary/success/warning/danger/disabled）、`TypographyEllipsis/Copyable/Editable` 结构，统一 Text/Paragraph/Title API 并支持 disabled。
  - [x] Title/Paragraph/Text 样式分层，行高/间距对齐 theme tokens，补充 code/mark/underline/delete 样式与 `.adui-text-*` 工具类。
  - [x] 交互：复制按钮 / tooltip、可编辑输入（Enter/Escape/Ctrl+Enter）、多行 ellipsis 展开/收起、ARIA/键盘事件，并落地 `IconKind::Copy/Edit`。
- [x] 组件重构：Layout
  - [x] Sider：提供 collapsible/collapsed_width/default_collapsed/trigger/zero width trigger/theme(light/dark)/on_collapse，并复用 `IconKind::ArrowLeft/Right` 作为默认触发。
  - [x] Layout/Header/Content/Footer：保留共享 props，新增 `has_sider` 标记并补齐背景/文字色；`THEME_BASE_STYLE` 中扩充相关类。
  - [x] 目前暂未实现 breakpoint 监听，已在文档中标注后续可再对齐。
- [x] 组件重构：Divider / Masonry / Splitter / Icon
  - [x] Divider：horizontal/vertical、dashed/plain、带文字位置（Left/Center/Right）、`orientation_margin`、ARIA 支持，并新增 `docs/divider.md` 与 demo 示例。
  - [x] Masonry：props 支持 columns/responsive/gap/row_gap/min_column_width，生成媒体查询控制列数，并更新 demo + `docs/masonry.md`。
  - [x] Splitter：受控/非受控 split、拖拽事件（on_change/on_moving/on_release）、触控支持、ARIA/gutter 样式，并更新 demo + `docs/splitter.md`。
  - [x] Icon：支持自定义 SVG (`custom`/`view_box`)、aria label 控制以及 rotate/size/spin 属性，更新 `docs/icon.md`。
- [ ] Demo 与文档
  - [ ] 扩充 `examples/`：覆盖新 API（Button loading delay/iconPlacement/group、Grid 响应式 gutter、Typography copyable/ellipsis、FloatButton group/backtop、Space wrap/split、Splitter 拖拽）。
    - [x] `flex_space_demo` 展示 FlexConfigProvider、gap 预设与 Space size/split/compact。
    - [x] `grid_demo` 覆盖 Row gutter（水平/垂直/响应式）与 Col span/offset/order 等响应式配置。
    - [x] 修复 `flex_space_demo` 的 `SpaceSize` 导入，`cargo check --example flex_space_demo` 通过。
    - [x] 修复 `grid_demo` RSX 逗号缺失，`cargo check --example grid_demo` 通过。
    - [x] 扩展 `typography_demo`，覆盖 tone 切换、可复制、多行省略、可编辑段落，`cargo check --example typography_demo` 通过。
    - [x] 更新 `layout_demo`：展示 Sider 受控折叠 + Zero Width Trigger，并通过 `cargo check --example layout_demo`。
    - [x] 扩展 `button_demo`：新增 ButtonGroup/variant/color 继承示例，展示 icon placement，`cargo check --example button_demo` 通过。
    - [x] 更新 `float_button_demo`：修复 BackTop 定位 props，展示 Group + Badge/Square 文案，`cargo check --example float_button_demo` 通过。
  - [ ] 创建 `docs/` 目录：组件概览、API 表（对齐 antd 命名）、示例片段、差异与迁移指南；更新 README 组件进度与运行说明。
    - [x] 新增 `docs/flex_space.md`，记录 Flex/Space 使用说明并在 README 暴露示例运行方式。
    - [x] 新增 `docs/grid.md`，说明 Row/Col 响应式 gutter 及栅格 API。
    - [x] 新增 `docs/typography.md`，记录 Text/Paragraph/Title API、copyable/ellipsis/Editable 使用方式与示例。
    - [x] 新增 `docs/layout.md`/`docs/divider.md`/`docs/masonry.md`/`docs/splitter.md`，说明对应组件的 API、示例与注意事项。
    - [x] 新增 `docs/button.md`，总结 color/variant/auto-insert-space 与 ButtonGroup 继承，用示例展示。
    - [x] 新增 `docs/float_button.md`，记录 FloatButton/Group/BackTop props、定位与 demo 入口，并同步 README。
    - [x] 新增 `docs/README.md` 作为索引与缺口清单。
  - [x] 在文档中列出未覆盖的 antd 能力与后续路线（见 `docs/README.md` 的“未覆盖能力”段落）。
- [ ] 测试与验证
  - [ ] 单元测试：主题 token 导出、工具函数（gap/gutter/ellipsis 计算、loading delay）、Button/FloatButton 行为（禁用/href/icon-only）、Typography copyable/ellipsis。
  - [ ] 集成测试：关键渲染快照（Button variant/iconPlacement、Grid 断点、FloatButton badge/tooltip、Typography 省略）、Splitter 拖拽模拟。
  - [ ] 手动验证：示例运行、暗色模式、RTL、键盘可达、禁用态、响应式断点。
  - [ ] 工具链：`cargo fmt`, `cargo clippy --all-targets --all-features`, `cargo test`，记录输出。
    - [x] 首次 `cargo fmt`。
    - [x] `cargo clippy --all-targets --all-features`：warnings 已清零（Button/Flex/Splitter/Typography/layout_demo 等 clone_on_copy 均已手动消除）。
    - [x] `cargo test`。
- [ ] 交付物与收尾
  - [ ] 汇总变更摘要与兼容性说明（弃用字段、新增 API）。
  - [ ] 已知问题与后续待办列表。
