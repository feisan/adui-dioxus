# 任务计划：导航与分页组件 Menu / Breadcrumb / Pagination（Phase 6）

## 一、背景与本轮目标

前几轮（`plan/0001`–`0008`）已经完成：

- 基础展示与布局：Button / FloatButton / Grid / Layout / Typography / Divider / Space / Flex / Splitter / Masonry 等；
- 表单与控件：Input / TextArea / Checkbox / Radio / Switch / Upload / Form + Form 高级能力（FormList、依赖字段、值映射等）；
- 选择器家族：Select / TreeSelect / Cascader / AutoComplete，与 Form 深度集成；
- 全局能力：ThemeProvider / ConfigProvider / App / OverlayManager；
- 浮层与反馈：Message / Notification / Modal / Drawer；
- 浮层提示家族：Tooltip / Popover / Popconfirm / Dropdown（已完成 MVP）。

在 Ant Design 体系中，另一个非常关键的维度是「导航与信息结构」：

- `Menu`：侧边/顶部导航，承载站点信息结构与当前选中态；
- `Breadcrumb`：面包屑路径，反映当前页面在层级结构中的位置；
- `Pagination`：分页器，控制列表类数据的页码切换与大小调整。

这些组件通常与 Layout、路由、列表视图（Table/List/Card）等协同使用，是构建中后台页面框架的基础。本轮（Phase 6）目标：

- 设计并实现 MVP 版本的 Menu / Breadcrumb / Pagination；
- 与 Layout / ConfigProvider / Theme 以及现有组件建立合理协同关系；
- 通过 demo 与文档沉淀导航/分页设计取舍，为后续 Table / Tabs / Steps 等组件打基础。

> 仍然采用 MVP 策略：优先覆盖常见用法（单列 Menu、简单 Breadcrumb 链、基本 Pagination），暂不追求 AntD 全量能力（多级路由集成、自动溢出、省略策略、多语言等）。

---

## 二、设计原则

1. **与 Layout 深度协同但保持解耦**
   - Menu 应该能自然嵌入现有 Layout/Sider/Header 结构，但不强绑定具体路由方案；
   - Breadcrumb 优先通过显式 `items` 或 `routes` 描述，而不是依赖运行时路由容器；
   - Pagination 独立于具体数据源，只通过回调（`onChange`）通知外层。

2. **对齐 AntD 的核心语义，裁剪复杂分支**
   - Menu：保留 `mode`（`inline` / `horizontal`）的核心差异，但初期只实现最常用子集（如 Sider 内的 `inline` + Header 内的简单横向菜单）；
   - Breadcrumb：重点在可组合的 `items` & `separator`，暂不实现 `itemRender` 的所有变体；
   - Pagination：支持 `current` / `pageSize` / `total` / `onChange` / `onShowSizeChange` 的基础行为，后续再扩展 `showQuickJumper` 等。

3. **组件独立 + 状态受控优先**
   - Menu：支持受控/非受控 `selectedKeys` / `openKeys`，Form 不直接参与，面向路由或应用状态；
   - Breadcrumb：自身是纯展示组件，自身不持久化状态；
   - Pagination：受控 `current` / `pageSize` 模式优先，内部非受控作为兜底。

4. **样式与主题统一**
   - 使用 ThemeTokens 提供的颜色/圆角/间距，保持与现有 Layout / Button / Typography 风格一致；
   - 尽量通过 class 名称（`.adui-menu-*` / `.adui-breadcrumb-*` / `.adui-pagination-*`）实现样式，而不是散落 inline 样式。

5. **文档中清晰标注能力范围**
   - 对比 AntD 6.0，明确当前支持/未支持的 props 与行为；
   - 后续扩展（如多级嵌套 Menu 拖拽排序、Breadcrumb 与路由自动映射、高级分页跳转等）在文档中预留规划。

---

## 三、任务拆解与 TODO

### A. 能力范围梳理与 API 草案

- [x] A1：调研 `tmp/antd-6.0.0/es` 下以下目录源码与类型声明：
  - `menu` / `breadcrumb` / `pagination`；
  - 重点关注：
    - Menu：`items` 结构（`key` / `label` / `icon` / `children` / `disabled`）、`mode`、`selectedKeys` / `openKeys`、`onClick` / `onOpenChange` 行为；
    - Breadcrumb：`items` / `routes` 模型、`separator`、图标和链接行为；
    - Pagination：`current` / `pageSize` / `total` / `showSizeChanger` / `showQuickJumper` 等核心 props。
- [x] A2：结合当前 Layout / Theme / App 能力，提炼本轮 **MVP 范围**：
  - Menu：
    - 支持 `items: Vec<MenuItem>` 树状结构，最多两级 children；
    - 支持 `mode = Inline | Horizontal`（其中 Horizontal MVP 可裁剪部分特性）；
    - 支持 `selected_keys` / `default_selected_keys` / `on_select`；
    - 支持 `open_keys` / `default_open_keys` / `on_open_change`（仅在 `inline` 模式下生效）。
  - Breadcrumb：
    - 支持 `items: Vec<BreadcrumbItem>`，包含 `label` / 可选 `href` / 可选 `onClick`；
    - 支持自定义 `separator` 文本/符号；
    - 暂不实现路由自动映射逻辑。
  - Pagination：
    - 支持受控 `current` / `page_size` / `total`，与 AntD 的 `PaginationProps` 核心语义对齐，但裁剪 `showQuickJumper` 等高级特性；
    - 支持 `on_change(page, page_size)` / `on_page_size_change(page, page_size)`；
    - 支持显示简单的总数文案（`show_total` 的简化版）；
    - 暂不实现复杂的简写页码省略策略（如 `...` 逻辑只做最基础版本）。
- [x] A3：在 `docs/app_config.md` 中增加一小节「导航与分页组件规划」，简述：
  - Menu + Breadcrumb + Pagination 与 Layout / Router / List/Table 的关系；
  - 与现有 Overlay / Form 等组件的交互边界（主要是互不干扰）。

### B. Menu：导航菜单（MVP）

- [x] B1：设计 `MenuItem` / `SubMenu` 模型与 `MenuProps`：
  - `MenuItem`（数据结构）：
    - `key: String`
    - `label: String`
    - `icon: Option<Element>`
    - `disabled: bool`
    - `children: Vec<MenuItem>`（子菜单）。
  - `MenuMode` 枚举：`Inline` / `Horizontal`；
  - `MenuProps` 关键字段：
    - `items: Vec<MenuItem>`；
    - `mode: MenuMode`；
    - `selected_keys: Option<Vec<String>>` / `default_selected_keys: Option<Vec<String>>`；
    - `open_keys: Option<Vec<String>>` / `default_open_keys: Option<Vec<String>>`（MVP 仅在 `Inline` 模式支持展开/折叠）；
    - `on_select: Option<EventHandler<String>>`（返回选中的 `key`）；
    - `on_open_change: Option<EventHandler<Vec<String>>>`；
    - `inline_collapsed: bool`（预留与 Sider 折叠联动，MVP 可只影响样式）；
    - `class` / `style`。
- [x] B2：在 `src/components/menu.rs` 实现 `Menu` 组件：
  - 内部管理 `selected_keys_internal` 与 `open_keys_internal`（仅在非受控时使用）；
  - 点击 Item：
    - 更新选中键集合（单选模式先实现：只保留一个）；
    - 触发 `on_select(key)`；
  - 点击有子菜单的 Item（SubMenu）：
    - 切换对应 `open_key`（仅 `Inline` 模式）；
    - 触发 `on_open_change(open_keys)`；
  - ARIA/可访问性基础属性（`role="menu"` / `role="menuitem"` 等）按简化版实现。
- [x] B3：样式与主题：在 `src/theme.rs` 中新增 `.adui-menu-*`：
  - 侧边菜单（`inline`）样式：宽度、背景、选中态、hover 态；
  - 顶部菜单（`horizontal`）样式：水平排列、下划线/高亮等基础效果；
  - 与 `Layout` 中 Header / Sider 的间距和背景保持一致。
- [x] B4：新增 demo：`examples/menu_demo.rs`：
  - Sider 内的 Inline Menu：模拟简单的“仪表盘 / 列表 / 设置”结构；
  - Header 内的 Horizontal Menu：展示顶部导航；
  - 展示受控 `selected_keys` + 外部按钮联动（如“选中设置项”）。
- [x] B5：新增文档：`docs/menu.md`：
  - 描述 Menu 组件的基本用法、API 字段、模式差异；
  - 说明当前与 AntD 的差异（暂不支持溢出、右键菜单、复杂 icon 布局等）。

### C. Breadcrumb：面包屑导航

- [x] C1：设计 `BreadcrumbItem` 模型与 `BreadcrumbProps`：
  - `BreadcrumbItem`：
    - `label: String`；
    - `href: Option<String>`（MVP 不处理实际跳转，只渲染 `<a>`）；
    - `on_click: Option<EventHandler<()>>`；
  - `BreadcrumbProps`：
    - `items: Vec<BreadcrumbItem>`；
    - `separator: Option<String>`（默认 `/`）；
    - `class` / `style`。
- [x] C2：在 `src/components/breadcrumb.rs` 实现 `Breadcrumb`：
  - 按顺序渲染 items，中间插入 `separator`；
  - 最后一个 item 视为当前页面，不渲染为链接（即使有 `href`）；
  - 点击可点击项时触发 `on_click`，并保留默认链接行为（若 `href` 存在）。
- [x] C3：样式：在 `src/theme.rs` 中新增 `.adui-breadcrumb-*`：
  - 基础行内布局、文字颜色；
  - 分隔符样式；
  - hover 状态下的链接颜色变化。
- [x] C4：新增 demo：`examples/breadcrumb_demo.rs`：
  - 展示一条典型路径（如「首页 / 列表 / 详情」）；
  - 展示自定义 `separator`（如 `>`）；
  - 通过点击触发 `use_message` 提示“点击了某节点”，用于验证行为。
- [x] C5：新增文档：`docs/breadcrumb.md`：
  - 记录 Breadcrumb 的 API 与使用范式；
  - 简述与路由系统集成的可能方式（本轮不实现，给出伪代码）。

### D. Pagination：分页器

- [x] D1：设计 `PaginationProps`：
  - `current: Option<u32>` / `default_current: Option<u32>`；
  - `page_size: Option<u32>` / `default_page_size: Option<u32>`；
  - `total: u32`；
  - `page_size_options: Option<Vec<u32>>`（MVP 默认 10/20/50）；
  - `show_size_changer: bool`；
  - `show_total: bool`（简化版，仅显示 `共 X 条`）；
  - `on_change: Option<EventHandler<(u32, u32)>>`；
  - `on_page_size_change: Option<EventHandler<(u32, u32)>>`；
  - `class` / `style`。
- [x] D2：在 `src/components/pagination.rs` 实现 `Pagination`：
  - 内部维护当前页与页面大小（仅在非受控场景、受控通过 props）；
  - 渲染：
    - 上一页 / 下一页 按钮（禁用状态处理）；
    - 若页数较多，采用简单省略策略（例如只展示首尾 + 当前前后几页 + `...`）；
    - 可选 pageSize 下拉（可复用 Select 或使用最小实现版本）。
- [x] D3：样式：在 `src/theme.rs` 中新增 `.adui-pagination-*`：
  - 行内分页按钮风格，与 Button/Link 较为一致；
  - 当前页高亮、禁用态、hover 态。
- [x] D4：新增 demo：`examples/pagination_demo.rs`：
  - 基本分页示例（总数 100，页面大小 10）；
  - 启用 `show_size_changer`，展示 pageSize 切换行为；
  - 使用 `use_signal` 打印当前页 / pageSize 变化。
- [x] D5：新增文档：`docs/pagination.md`：
  - 记录 Pagination 的 API 与行为；
  - 强调它与实际数据列表（Table/List）的协作方式（通过受控模式向外推状态）。

### E. 集成验证与收尾

- [x] E1：构建一个导航综合示例：`examples/layout_navigation_demo.rs`：
  - 使用 Layout + Sider + Header + Content；
  - Sider 内嵌 `Menu`；Header 内渲染简单 `Breadcrumb`；Content 区展示一个带 `Pagination` 的列表；
  - 验证在不同 viewport 下样式与交互是否合理。
- [x] E2：确保新模块通过 `cargo fmt` / `cargo clippy --all-targets --all-features` / `cargo test`，并记录：
  - clippy 新增/重要警告（如有）与处理方案；
  - 如有必要，为 Menu/Breadcrumb/Pagination 的关键逻辑添加单元测试（例如页码计算、Breadcrumb 末节点渲染规则等）。
- [x] E3：更新文档索引 `docs/README.md`：
  - 增加 Menu / Breadcrumb / Pagination 的条目与链接；
  - 在 Layout 文档中添加对 Menu/Breadcrumb 集成示例的引用；
  - 若有新的设计决策（如 Menu 仅支持两级嵌套），在相关文档中显式说明。
