# 任务计划：移植 Ant Design 表单基础控件（Phase 1）

## 目标与范围
- 在现有 `adui-dioxus` 体系下，引入一批表单基础控件：`Input` / `TextArea`、`Checkbox` / `Checkbox.Group`、`Radio` / `Radio.Group` / `Radio.Button`、`Switch`。
- 对齐 `tmp/antd-6.0.0/lib` 中对应组件的核心 API 与交互行为（受控/非受控、尺寸、状态、键盘可达性）。
- 与现有 `Form` / `FormItem`、`ThemeTokens`、`Button` / `Space` / `Grid` 紧密协同，为更复杂表单与筛选面板打基础。
- 本计划为 Phase 1，暂不实现 `Select` / `InputNumber` / `Input.Password` / `Input.Search` 等扩展，先保证基础控件闭环可用。

## 总体策略
- 以 **Input + 布尔类控件** 为一个批次，一次性补齐最常用的“文本输入 + 勾选/切换”控件。
- 抽出共用的尺寸与状态抽象（`ControlSize` / `ControlStatus`），并扩展 theme CSS 变量，后续 Select/InputNumber 等也可复用。
- 采用统一的受控/非受控模型：
  - 非受控：内部使用 `Signal<T>` 保存值，初始化自 `default_*`，并向 `FormItem` store 同步。
  - 受控：传入 `value`/`checked` 时不内部写值，仅调用回调，由外部管理状态。
- 尽量让 `FormItem` 的使用体验接近 antd：`Form.Item` 包裹控件时，控件默认与当前字段名绑定（Input 使用 `value`，Checkbox/Radio/Switch 使用 `checked` 或布尔值），减少调用方样板代码。

## 阶段划分

### Phase 1（本计划实际落地范围）
1. Input 系列基础：
   - `Input`（单行文本）
   - `TextArea`
2. 布尔/单选控件：
   - `Checkbox` / `Checkbox.Group`
   - `Radio` / `Radio.Group` / `Radio.Button`
   - `Switch`

### Phase 2（预留，暂不编码，仅在计划中记录）
1. Input 扩展：`Input.Password`、`Input.Search`。
2. 数值输入：`InputNumber`。
3. 选择器：`Select`（单选/多选 + 基础弹层）。

> Phase 2 将在 Phase 1 基础设施稳定后另起计划或在本文件追加 TODO。

## 设计要点

### 通用尺寸与状态
- 复用/扩展 `theme.rs` 中现有 `ControlSize` 与 token：
  - 使用 `control_height/control_height_small/control_height_large` 作为 Input/Checkbox/Radio/Switch 的高度基础。
  - 基于 `color_border/color_error/color_warning/color_text_disabled` 等推导控件的边框与文字颜色。
- 抽象一个内部帮助枚举/函数（不一定导出）：
  - `ControlSizeKind`：Small/Middle/Large → 对应高度、padding、字号。
  - `ControlStatus`：Default/Success/Warning/Error → 用于决定边框/阴影类名（未来可与 Form 校验状态结合）。

### Input / TextArea
- Props 草案：
  - `value: Option<String>` / `default_value: Option<String>`
  - `size: ControlSize`（沿用现有枚举）
  - `disabled: bool`
  - `allow_clear: bool`
  - `prefix: Option<Element>` / `suffix: Option<Element>`
  - `addon_before: Option<Element>` / `addon_after: Option<Element>`
  - `placeholder: Option<String>`
  - `on_change: Option<EventHandler<String>>`
  - `on_press_enter: Option<EventHandler<()>>`（Input 专用）
- 行为：
  - 非受控：内部 `Signal<String>` 保存值；
  - 受控：传入 `value` 时不写 signal，只在输入事件中调用 `on_change`；
  - 在有 `FormItemControlContext` 时，将读取/写入 FormStore（优先级：外部 `value` > Form store > 内部 signal）。
- TextArea 额外：
  - `rows: Option<u16>`
  - `auto_size: Option<(u16,u16)>`（简化为 min_rows/max_rows，先通过 `rows` 属性控制，不做 DOM 测量）。

### Checkbox / Radio / Switch
- Checkbox：
  - Props：`checked: Option<bool>`、`default_checked: bool`、`indeterminate: bool`、`disabled: bool`、`on_change: Option<EventHandler<bool>>`、`value: Option<String>`、`children: Element`。
  - 行为：
    - 非受控：内部 `Signal<bool>`；
    - 在 `FormItem` 中：若 Form 字段值为布尔，直接对应 `checked`；若为数组（未来扩展），则作为 Group 使用。
- Checkbox.Group：
  - Props：`options`（简化版本）、`value: Option<Vec<String>>`、`default_value: Vec<String>`、`on_change`。
  - 使用 context 向子 Checkbox 传递当前选中集合与变更函数。

- Radio / Radio.Group / Radio.Button：
  - Radio Props：`value: String`、`checked: Option<bool>`、`disabled`、`on_change`。
  - Group：`value: Option<String>`、`default_value: Option<String>`、`name: Option<String>`、`on_change`，通过 context 控制唯一选中值。
  - Radio.Button：与 Radio 共享逻辑，只在样式上呈现“按钮型”形态（内部使用不同 class）。

- Switch：
  - Props：`checked: Option<bool>`、`default_checked: bool`、`disabled: bool`、`size: ControlSize`（或单独 Small/Default）、`checked_children: Option<Element>`、`un_checked_children: Option<Element>`、`on_change: Option<EventHandler<bool>>`。
  - 行为：
    - 可通过点击或键盘 Space/Enter 切换；
    - 提供 `role="switch"` 和 `aria-checked`。

### Form 集成
- Input/TextArea：
  - 若存在 `FormItemControlContext`，优先从 `ctx.value()` 读值（字符串 / 数字 / bool → 字符串）；
  - 输入时调用 `ctx.set_string(new_value)` 同步 store，再触发外部 `on_change`。
- Checkbox/Radio/Switch：
  - 如果 Form 字段为布尔值：直接映射到 `checked`。
  - 如果使用 Group：将 `Form` 中的值视为当前选中 key（Radio）或选中数组（Checkbox），与 context 管理的选中集合保持一致。

## TODO 列表（Phase 1 可执行）

- [x] 基础设施与样式
  - [x] 复查 `theme.rs` 中现有控制尺寸 token，补充必要说明/注释（不一定新增字段）。
  - [x] 在基础样式中新增 Input/Checkbox/Radio/Switch 相关类（`THEME_BASE_STYLE` 或对应宏），对齐 antd 6 的基础视觉：高度、边框、hover/focus/disabled 状态。
  - [x] 设计/实现内部 `ControlStatus` 辅助（先只在 Input 系列中使用，后续可用于 Form 校验态）。

- [x] Input / TextArea 组件
  - [x] 在 `src/components` 新增 `input.rs`（命名待定），导出 `Input` 与 `TextArea` 组件。
  - [x] 设计 `InputProps` / `TextAreaProps`，与上述 API 草案对齐，并考虑与 antd 命名映射。
  - [x] 实现非受控模式（内部 `Signal<String>`）以及 `default_value` 初始化逻辑。
  - [x] 实现受控模式：当传入 `value` 时仅触发回调，不修改内部 signal。
  - [x] 支持 `FormItemControlContext`：在存在 context 时从 store 读写值。
  - [x] 处理 `allow_clear/prefix/suffix` 的布局与交互（点击清除图标清空值并同步 Form；`addon_*` 预留后续扩展）。

- [x] Checkbox / Checkbox.Group
  - [x] 在 `src/components` 新增 `checkbox.rs`，定义 `Checkbox` 与 `CheckboxGroup`。
  - [x] 设计 Props：包含 `checked/default_checked/indeterminate/disabled/on_change/value/status/class/style/children` 等。
  - [x] 实现无 Group 情况下的简单布尔切换与 Form 集成（布尔字段映射为 `checked` 并写回 `FormStore`）。
  - [x] 实现 Group：使用 context 管理选中集合，支持受控与非受控，并在变更时触发组级 `on_change`。
  - [x] 样式：复用 `adui_control_style` 中的 `.adui-checkbox*`，勾选/indeterminate/禁用态与 antd 行为保持一致（后续可再微调细节）。 

- [x] Radio / Radio.Group / Radio.Button
  - [x] 在 `src/components` 新增 `radio.rs`，导出 `Radio`、`RadioGroup`、`RadioButton`。
  - [x] 设计 Props：`value/checked/default_checked/disabled/status/class/style/on_change/button` 等。
  - [x] 实现 Group 上下文：使用 `RadioGroupContext` 和 `Signal<Option<String>>` 管理唯一选中值。
  - [x] Radio.Button：通过 `Radio(RadioProps { button: true, ..props })` 复用逻辑，按钮型样式留给样式层扩展。
  - [x] 与 Form 集成：RadioGroup 内部读取 `FormItemControlContext` 的值初始化选中项，并在切换时通过 `set_string` 写回 FormStore。

- [x] Switch 组件
  - [x] 在 `src/components` 新增 `switch.rs`，导出 `Switch`。
  - [x] 设计 Props：`checked/default_checked/disabled/size/checked_children/un_checked_children/status/class/style/on_change`。
  - [x] 实现点击与键盘触发切换（Enter/Space），设置 `role=\"switch\"` 与 `aria-checked`。
  - [x] 与 Form 集成：在存在 `FormItemControlContext` 时读取/写回布尔字段，与 Form 保持同步。

- [x] 集成导出与 Demo
  - [x] 在 `src/components/mod.rs` 和 `src/lib.rs` 导出新的组件（Input/Checkbox/Radio/Switch）。
  - [x] 新增 `examples/input_checkbox_demo.rs`：展示 Input/TextArea + Checkbox/Radio/Switch 与 Form 的组合用法（登录/偏好设置）。
  - [x] 更新现有 `form_demo`，将手写 `input` 替换为 `Input`/`TextArea` 组件，减少重复逻辑并验证 Form 集成。

- [x] 文档
  - [x] 新增 `docs/input.md`，记录 Input/TextArea 的 API、受控/非受控模式、与 antd 的差异。
  - [x] 新增 `docs/checkbox_radio_switch.md`（或拆为两个文件），说明 Checkbox/Radio/Switch 的 API、Group 模式与 Form 集成方式。
  - [x] 在 `docs/README.md` 中补充新组件索引，并在“未覆盖能力”中移动已完成项（如 Input 基础）。

- [ ] 测试与验证
  - [ ] 单元测试：
    - [x] 控件尺寸/状态辅助函数（`ControlStatus` 已有测试覆盖 class 映射与 push 行为）。
    - [x] Input 受控/非受控值更新逻辑（通过扩展 `form_value_to_string` 测试覆盖 Form 值到字符串的转换分支；`apply_input_value` 依赖 Dioxus runtime，暂保留在集成层验证）。
    - [x] Checkbox.Group / Radio.Group 选中集合的变更函数（通过 `toggle_membership` 纯函数测试覆盖 CheckboxGroup 行为）。
  - [ ] 手动测试（需在本机浏览器中执行）：
    - [ ] `dx serve --example input_checkbox_demo`，检查所有控件的交互、禁用态与键盘操作。
      - 助手环境尝试结果：`dx serve` 由于沙箱限制无法绑定端口（`Operation not permitted (os error 1)`），因此无法在当前会话内完成此步，只能由本机人工运行。
    - [ ] `dx serve --example form_demo`，验证 Form 与新控件的联动（提交、重置、校验）。
      - 建议在同一浏览器会话中联动验证表单提交/重置、校验提示与控件视觉状态，确认与 antd 行为一致后再将上述勾选标记为完成。
  - [x] 跑通工具链：`cargo fmt`、`cargo clippy --all-targets --all-features`、`cargo test`（本轮已在本地执行，存在若干 clippy 建议性 warning，主要集中在 upload/grid 逻辑，暂未调整行为），在 `docs/testing_report.md` 或 plan 中记录结果。

## 后续（Phase 2 预留 TODO）
- [ ] 设计 `Input.Password` / `Input.Search`：在 Input 内核基础上增加图标按钮与行为（显隐密码、搜索回车等）。
- [ ] 设计/实现 `InputNumber`：解析数值输入、加减按钮、步长/精度控制，与 `FormRule` 的 `min/max` 对齐。
- [ ] 设计/实现基础 `Select`：单选/多选、搜索、下拉弹层；考虑复用未来的 Popup/Dropdown 基础设施。
